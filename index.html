<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>DJ ALDO GL1TCH BOSS SHOW</title>
<style>
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  body {
    margin: 0;
    background: #020617;
    color: #e5e7eb;
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    transition: background 0.4s, filter 0.3s;
  }

  .stage {
    width: 90%;
    max-width: 900px;
    background: rgba(15, 23, 42, 0.95);
    border-radius: 24px;
    padding: 28px 24px 32px;
    box-shadow: 0 30px 60px rgba(0, 0, 0, 0.7);
    position: relative;
    text-align: center;
    transition: border 0.3s, box-shadow 0.3s, transform 0.3s, filter 0.3s;
    overflow: hidden;
  }

  h1 {
    font-size: 2.4rem;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    margin-bottom: 10px;
  }

  .subtitle {
    font-size: 0.95rem;
    opacity: 0.8;
    margin-bottom: 16px;
  }

  .status {
    font-size: 0.9rem;
    opacity: 0.8;
    margin-bottom: 18px;
  }

  .generator {
    margin-top: 10px;
  }

  textarea {
    width: 100%;
    height: 220px;
    background: #020617;
    color: #e5e7eb;
    border-radius: 14px;
    border: 1px solid #1f2937;
    padding: 12px 14px;
    font-size: 0.95rem;
    resize: none;
    outline: none;
  }

  textarea:focus {
    border-color: #22c55e;
    box-shadow: 0 0 0 1px #22c55e33;
  }

  .btn {
    margin-top: 14px;
    padding: 10px 26px;
    border-radius: 999px;
    border: none;
    background: linear-gradient(to right, #22c55e, #16a34a);
    color: white;
    font-size: 0.9rem;
    font-weight: 600;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    cursor: pointer;
    box-shadow: 0 10px 20px rgba(16, 185, 129, 0.45);
    transition: transform 0.1s, box-shadow 0.1s, filter 0.1s;
  }

  .btn:hover {
    transform: translateY(-1px);
    filter: brightness(1.05);
    box-shadow: 0 14px 26px rgba(16, 185, 129, 0.55);
  }

  .btn:active {
    transform: translateY(1px);
    box-shadow: 0 6px 14px rgba(16, 185, 129, 0.4);
  }

  .sentence-display {
    margin-top: 26px;
    min-height: 80px;
    font-size: 1.3rem;
    line-height: 2.1rem;
    white-space: pre-wrap;
    padding: 10px 8px;
  }

  .hint {
    margin-top: 8px;
    font-size: 0.8rem;
    opacity: 0.65;
  }

  .controls-end {
    margin-top: 22px;
    display: flex;
    justify-content: center;
    gap: 14px;
  }

  .btn-secondary {
    background: #1f2937;
    box-shadow: none;
  }

  .btn-secondary:hover {
    filter: brightness(1.05);
  }

  .sentence {
    transition: transform 0.2s, opacity 0.2s;
  }

  .sentence.pixelated {
    font-family: "Courier New", ui-monospace, monospace;
    font-size: 1.35rem;
    letter-spacing: 0.14em;
    color: #fecaca;
    text-shadow: 0 0 8px #ef4444;
    animation: pixelShake 0.13s infinite;
  }

  @keyframes pixelShake {
    0%   { transform: translate(0,0) scale(1); }
    50%  { transform: translate(-2px,1px) scale(1.04); }
    100% { transform: translate(2px,-1px) scale(1); }
  }

  body.glitch-phase-1 {
    background: radial-gradient(circle at center, #7f1d1d, #000);
    filter: hue-rotate(-12deg) saturate(1.5);
    animation: bodyShake 0.22s infinite;
  }

  @keyframes bodyShake {
    0%   { transform: translate(0,0); }
    25%  { transform: translate(2px,-2px); }
    50%  { transform: translate(-2px,2px); }
    75%  { transform: translate(1px,-1px); }
    100% { transform: translate(0,0); }
  }

  body.glitch-phase-2 {
    background: radial-gradient(circle at center, #450a0a, #020617);
    filter: hue-rotate(-20deg) saturate(2.2) contrast(1.2);
    animation: bodyShakeBoss 0.18s infinite;
  }

  @keyframes bodyShakeBoss {
    0%   { transform: translate(0,0) scale(1); }
    25%  { transform: translate(3px,-3px) scale(1.01); }
    50%  { transform: translate(-3px,3px) scale(1.01); }
    75%  { transform: translate(2px,-2px) scale(1.005); }
    100% { transform: translate(0,0) scale(1); }
  }

  .stage.phase-1 {
    border: 2px solid rgba(248, 113, 113, 0.8);
    box-shadow: 0 30px 80px rgba(248, 113, 113, 0.35);
    filter: brightness(1.05);
  }

  .stage.phase-2 {
    border: 2px dashed rgba(239, 68, 68, 0.95);
    box-shadow: 0 0 0 2px rgba(248, 113, 113, 0.6), 0 35px 120px rgba(127, 29, 29, 0.9);
    animation: stageGlitch 0.2s infinite;
    filter: brightness(1.12) contrast(1.06);
  }

  @keyframes stageGlitch {
    0%   { transform: translate(0,0) skew(0deg, 0deg); }
    50%  { transform: translate(-2px,1px) skew(-0.4deg, 0.5deg); }
    100% { transform: translate(2px,-1px) skew(0.4deg, -0.5deg); }
  }

  .crack {
    position: absolute;
    width: 120px;
    height: 120px;
    pointer-events: none;
    opacity: 0;
    mix-blend-mode: screen;
    transition: opacity 0.25s, filter 0.25s, transform 0.25s;
    z-index: 50;
  }

  .crack::before,
  .crack::after {
    content: "";
    position: absolute;
    background: linear-gradient(to right, rgba(255,255,255,0.1), rgba(255,255,255,0.9));
    box-shadow: 0 0 12px rgba(255,255,255,0.7);
  }

  .crack-top-left {
    top: -10px;
    left: -10px;
    transform-origin: top left;
  }
  .crack-top-left::before {
    width: 3px;
    height: 100%;
    top: 0;
    left: 18px;
    transform: rotate(10deg);
  }
  .crack-top-left::after {
    width: 100%;
    height: 3px;
    top: 20px;
    left: 0;
    transform: rotate(-12deg);
  }

  .crack-top-right {
    top: -10px;
    right: -10px;
    transform-origin: top right;
  }
  .crack-top-right::before {
    width: 3px;
    height: 100%;
    top: 0;
    right: 18px;
    transform: rotate(-10deg);
  }
  .crack-top-right::after {
    width: 100%;
    height: 3px;
    top: 20px;
    right: 0;
    transform: rotate(12deg);
  }

  .crack-bottom-left {
    bottom: -10px;
    left: -10px;
    transform-origin: bottom left;
  }
  .crack-bottom-left::before {
    width: 3px;
    height: 100%;
    bottom: 0;
    left: 18px;
    transform: rotate(-10deg);
  }
  .crack-bottom-left::after {
    width: 100%;
    height: 3px;
    bottom: 20px;
    left: 0;
    transform: rotate(12deg);
  }

  .crack-bottom-right {
    bottom: -10px;
    right: -10px;
    transform-origin: bottom right;
  }
  .crack-bottom-right::before {
    width: 3px;
    height: 100%;
    bottom: 0;
    right: 18px;
    transform: rotate(10deg);
  }
  .crack-bottom-right::after {
    width: 100%;
    height: 3px;
    bottom: 20px;
    right: 0;
    transform: rotate(-12deg);
  }

  .stage.cracked-soft .crack {
    opacity: 0.45;
    filter: brightness(1.2);
  }

  .stage.cracked-hard .crack {
    opacity: 0.9;
    filter: brightness(1.6);
    transform: scale(1.02);
  }

  .stage.cracked-boss .crack {
    animation: crackPulse 0.35s infinite alternate;
  }

  @keyframes crackPulse {
    from { filter: brightness(1.6); }
    to   { filter: brightness(2) drop-shadow(0 0 8px rgba(255,255,255,0.9)); }
  }

  .scanlines {
    display: none;
    position: fixed;
    inset: 0;
    pointer-events: none;
    background-image: repeating-linear-gradient(
      to bottom,
      rgba(0, 0, 0, 0.24) 0px,
      rgba(0, 0, 0, 0.24) 1px,
      transparent 1px,
      transparent 3px
    );
    mix-blend-mode: multiply;
    z-index: 995;
    animation: scanMove 3.5s linear infinite;
  }

  .scanlines.active {
    display: block;
  }

  @keyframes scanMove {
    from { background-position-y: 0; }
    to   { background-position-y: 120px; }
  }

  .glitch-words {
    position: absolute;
    inset: 0;
    pointer-events: none;
    overflow: hidden;
    font-family: "SF Mono", ui-monospace, monospace;
    font-size: 0.75rem;
    mix-blend-mode: screen;
    z-index: 90;
  }

  .glitch-word {
    position: absolute;
    color: rgba(248, 113, 113, 0.95);
    text-shadow: 0 0 7px rgba(248, 113, 113, 0.95);
    animation: wordFlicker 0.35s infinite;
    white-space: nowrap;
  }

  @keyframes wordFlicker {
    0%   { opacity: 0; transform: translateY(0); }
    50%  { opacity: 1; transform: translateY(-2px); }
    100% { opacity: 0; transform: translateY(3px); }
  }

  .flash-overlay {
    position: fixed;
    inset: 0;
    background: radial-gradient(circle at center, rgba(248,113,113,0.45), rgba(0,0,0,0.9));
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.15s;
    z-index: 998;
  }

  .flash-overlay.visible {
    opacity: 1;
  }

  .blackout {
    position: fixed;
    inset: 0;
    background: radial-gradient(circle at center, transparent 45%, rgba(0,0,0,0.95) 100%);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
    z-index: 997;
  }

  .blackout.active {
    opacity: 1;
  }

  .cursor-fragment {
    position: fixed;
    width: 10px;
    height: 10px;
    border-radius: 999px;
    background: rgba(248,113,113,0.9);
    box-shadow: 0 0 12px rgba(248,113,113,0.9);
    pointer-events: none;
    z-index: 996;
    opacity: 0.9;
    animation: fragmentFade 0.5s forwards;
  }

  @keyframes fragmentFade {
    0%   { transform: scale(1); opacity: 0.9; }
    50%  { transform: scale(1.4); opacity: 0.6; }
    100% { transform: scale(0.7); opacity: 0; }
  }

  .code-fragment {
    position: fixed;
    top: -40px;
    color: #e5e7eb;
    font-family: "SF Mono", ui-monospace, monospace;
    font-size: 0.75rem;
    white-space: pre;
    text-shadow: 0 0 6px rgba(248, 250, 252, 0.9);
    pointer-events: none;
    z-index: 94;
    opacity: 0.9;
    animation: codeFall 1.8s linear forwards;
  }

  @keyframes codeFall {
    0% {
      transform: translateY(-40px) scale(1);
      opacity: 0;
    }
    20% {
      opacity: 1;
    }
    80% {
      transform: translateY(60vh) scale(1.03);
      opacity: 1;
    }
    100% {
      transform: translateY(70vh) scale(0.7) rotate(3deg);
      opacity: 0;
      filter: blur(2px);
    }
  }

  /* tiny pixel shards that stay along top of widget */
  .pixel-shard {
    position: absolute;
    width: 4px;
    height: 4px;
    background: #f9fafb;
    box-shadow: 0 0 6px rgba(248,250,252,0.9);
    opacity: 0.85;
    border-radius: 1px;
    z-index: 60;
  }

  @media (max-width: 600px) {
    h1 {
      font-size: 1.9rem;
      letter-spacing: 0.12em;
    }
    .stage {
      padding: 22px 16px 28px;
    }
  }
</style>
</head>
<body>

<div class="scanlines" id="scanlines"></div>
<div class="flash-overlay" id="flashOverlay"></div>
<div class="blackout" id="blackoutOverlay"></div>

<div class="stage" id="stage">
  <div class="crack crack-top-left"></div>
  <div class="crack crack-top-right"></div>
  <div class="crack crack-bottom-left"></div>
  <div class="crack crack-bottom-right"></div>

  <h1>DJ ALDO GL1TCH B0SS</h1>
  <p class="subtitle" id="subtitleText">
    Paste your text once, then reveal it sentence by sentence. Repeated words drop infinite Python shards.
  </p>
  <p class="status" id="statusText">
    Short words appear one character at a time. Falling code shatters into tiny pixels along the top edge.
  </p>

  <div class="generator" id="generator">
    <textarea id="lyricsInput" placeholder="Paste your lyrics or text here (can be very long)..."></textarea>
    <button class="btn" id="startBtn">Start Show</button>
  </div>

  <div class="sentence-display" id="sentenceDisplay"></div>

  <p class="hint" id="hintText">
    After you start, click anywhere on the screen to show the next sentence or word.
  </p>

  <div class="controls-end" id="endControls" style="display:none;">
    <button class="btn btn-secondary" id="retryBtn">Retry</button>
    <button class="btn" id="regenBtn">Regenerate</button>
  </div>

  <div class="glitch-words" id="glitchWordsContainer"></div>
</div>

<script>
  const generator = document.getElementById("generator");
  const lyricsInput = document.getElementById("lyricsInput");
  const startBtn = document.getElementById("startBtn");
  const sentenceDisplay = document.getElementById("sentenceDisplay");
  const statusText = document.getElementById("statusText");
  const subtitleText = document.getElementById("subtitleText");
  const hintText = document.getElementById("hintText");
  const endControls = document.getElementById("endControls");
  const retryBtn = document.getElementById("retryBtn");
  const regenBtn = document.getElementById("regenBtn");
  const glitchWordsContainer = document.getElementById("glitchWordsContainer");
  const scanlines = document.getElementById("scanlines");
  const stage = document.getElementById("stage");
  const flashOverlay = document.getElementById("flashOverlay");
  const blackoutOverlay = document.getElementById("blackoutOverlay");

  const GLITCH_WORDS = [
    "GL1TCH",
    "R3D ALERT",
    "SYS_ERR",
    "K3RN3L PAN1C",
    "OVRDR1V3",
    "D4TA FR4CTURE",
    "M3MORY LE4K",
    "N01SE",
    "PACKET L0SS",
    "CORRUPT_STREAM",
    "F4T4L 3RR0R",
    "███",
    "NO SIGNAL",
    "DESYNC",
    "REBOOT_REQ",
    "STACK OVERFL0W",
    "SEGMENTATI0N FAULT",
    "S0UL DUMP",
    "LOST FRAME",
    "CR1T1CAL HEARTBEAT"
  ];

  const PYTHON_SNIPPETS = [
    "for i in range(10):\n    print(i)",
    "if error:\n    raise Exception('fatal')",
    "try:\n    risky()\nexcept:\n    crash()",
    "while True:\n    glitch()",
    "state = 'CORRUPT'",
    "buffer = [0,1,0,1,0,1]",
    "def reboot():\n    return False",
    "import sys\nsys.exit(1)",
    "log.append('FORMALITY_BROKEN')",
    "if not safe:\n    shutdown()"
  ];

  let sentences = [];
  let currentIndex = 0;
  let showMode = "idle"; // idle | playing | finished
  let glitchActive = false;
  let glitchIntervalFast = null;
  let triggerCount = 0;
  const BOSS_PHASE_TRIGGER_COUNT = 3;

  let charInterval = null;

  let repeatedWordsSet = new Set();
  let endlessCodeInterval = null;

  function splitIntoSentences(text) {
    const raw = text
      .split(/\n+/)
      .join(" ")
      .split(/(?<=[.!?])\s+/);

    return raw
      .map(s => s.trim())
      .filter(s => s.length > 0);
  }

  function computeRepeatedWords(text) {
    const cleaned = text
      .toLowerCase()
      .replace(/[^a-z0-9\s]/g, " ");
    const words = cleaned.split(/\s+/).filter(Boolean);

    const counts = {};
    words.forEach(w => {
      counts[w] = (counts[w] || 0) + 1;
    });

    const result = new Set();
    Object.keys(counts).forEach(w => {
      if (counts[w] > 1) result.add(w);
    });
    return result;
  }

  function sentenceHasRepeatedWord(sentence) {
    if (repeatedWordsSet.size === 0) return false;
    const cleaned = sentence
      .toLowerCase()
      .replace(/[^a-z0-9\s]/g, " ");
    const words = cleaned.split(/\s+/).filter(Boolean);
    return words.some(w => repeatedWordsSet.has(w));
  }

  function showSentence(index) {
    if (index < 0 || index >= sentences.length) return;
    const s = sentences[index];

    sentenceDisplay.innerHTML = "";

    const trimmed = s.trim();
    const isShort = trimmed.length > 0 && trimmed.length <= 16;

    const span = document.createElement("span");
    span.className = "sentence pixelated";
    sentenceDisplay.appendChild(span);

    triggerCount++;
    activateGlitch();
    if (triggerCount >= BOSS_PHASE_TRIGGER_COUNT) {
      activateBossPhase();
    }

    if (sentenceHasRepeatedWord(s)) {
      spawnCodeRain(4 + Math.floor(Math.random() * 4));
    }

    if (charInterval) {
      clearInterval(charInterval);
      charInterval = null;
    }

    if (isShort) {
      let i = 0;
      charInterval = setInterval(() => {
        if (i < trimmed.length) {
          span.textContent += trimmed[i];
          i++;
        } else {
          clearInterval(charInterval);
          charInterval = null;
        }
      }, 70);
    } else {
      span.textContent = s;
    }
  }

  function activateGlitch() {
    if (!glitchActive) {
      glitchActive = true;
      document.body.classList.add("glitch-phase-1");
      scanlines.classList.add("active");
      stage.classList.add("phase-1");
      stage.classList.add("cracked-hard");
      statusText.textContent = "GLITCH MODE: Every word is cracking the system.";
      subtitleText.textContent = "Short words slice in like error codes. Repeated ones drop Python shards.";
      glitchIntervalFast = setInterval(spawnGlitchWord, 80);
      flashStage();
    } else {
      flashStage();
      stage.classList.add("cracked-hard");
    }
  }

  function activateBossPhase() {
    if (!document.body.classList.contains("glitch-phase-2")) {
      document.body.classList.remove("glitch-phase-1");
      document.body.classList.add("glitch-phase-2");
      stage.classList.remove("phase-1");
      stage.classList.add("phase-2");
      stage.classList.add("cracked-boss");
      statusText.textContent = "BOSS FORM: The widget has fully crashed (visually).";
      subtitleText.textContent = "Phase 2 engaged. Every click pushes it deeper. Code keeps falling.";
      randomBlackoutAttack();
    }
  }

  function flashStage() {
    flashOverlay.classList.add("visible");
    setTimeout(() => {
      flashOverlay.classList.remove("visible");
    }, 130);
  }

  function spawnGlitchWord() {
    const word = document.createElement("div");
    word.className = "glitch-word";
    word.textContent = GLITCH_WORDS[Math.floor(Math.random() * GLITCH_WORDS.length)];

    const rect = stage.getBoundingClientRect();
    const x = Math.random() * rect.width;
    const y = Math.random() * rect.height;

    word.style.left = x + "px";
    word.style.top = y + "px";
    word.style.fontSize = (0.7 + Math.random() * 1.5) + "rem";

    const hue = 0 + Math.random() * 20;
    word.style.color = `hsl(${hue}, 90%, 62%)`;
    word.style.textShadow = `0 0 9px hsl(${hue}, 100%, 65%)`;

    glitchWordsContainer.appendChild(word);

    setTimeout(() => {
      word.remove();
    }, 600 + Math.random() * 400);
  }

  function spawnCodeRain(count) {
    for (let i = 0; i < count; i++) {
      const code = document.createElement("div");
      code.className = "code-fragment";
      code.textContent = PYTHON_SNIPPETS[Math.floor(Math.random() * PYTHON_SNIPPETS.length)];

      const screenWidth = window.innerWidth;
      const x = Math.random() * screenWidth;
      code.style.left = x + "px";

      code.style.animationDuration = (1.4 + Math.random() * 0.8) + "s";

      document.body.appendChild(code);

      code.addEventListener("animationend", () => {
        createPixelShatterAboveStage(code);
        code.remove();
      });
    }
  }

  function createPixelShatterAboveStage(codeElement) {
    const rectStage = stage.getBoundingClientRect();
    const numShards = 6 + Math.floor(Math.random() * 10);
    for (let i = 0; i < numShards; i++) {
      const shard = document.createElement("div");
      shard.className = "pixel-shard";

      const offsetX = Math.random() * rectStage.width;
      const offsetY = Math.random() * 12; // small band at top

      shard.style.left = rectStage.left + offsetX + "px";
      shard.style.top = rectStage.top + offsetY + "px";

      document.body.appendChild(shard);
      // they stay forever like broken glass dust
    }
  }

  function startEndlessCodeRain() {
    if (endlessCodeInterval) return;
    endlessCodeInterval = setInterval(() => {
      spawnCodeRain(1 + Math.floor(Math.random() * 3));
    }, 500);
  }

  function stopEndlessCodeRain() {
    if (!endlessCodeInterval) return;
    clearInterval(endlessCodeInterval);
    endlessCodeInterval = null;
  }

  function resetGlitchVisuals() {
    glitchActive = false;
    triggerCount = 0;
    document.body.classList.remove("glitch-phase-1", "glitch-phase-2");
    stage.classList.remove("phase-1", "phase-2");
    stage.classList.remove("cracked-soft", "cracked-hard", "cracked-boss");
    scanlines.classList.remove("active");
    glitchWordsContainer.innerHTML = "";
    flashOverlay.classList.remove("visible");
    blackoutOverlay.classList.remove("active");
    if (glitchIntervalFast) {
      clearInterval(glitchIntervalFast);
      glitchIntervalFast = null;
    }
    if (charInterval) {
      clearInterval(charInterval);
      charInterval = null;
    }
    stage.style.boxShadow = "0 30px 60px rgba(0, 0, 0, 0.7)";
    document.body.style.filter = "";
    // Note: we do NOT clear pixel shards or stop endless rain here,
    // because you said only refresh should stop everything.
  }

  function randomBlackoutAttack() {
    if (!document.body.classList.contains("glitch-phase-2")) return;

    setTimeout(() => {
      if (!document.body.classList.contains("glitch-phase-2")) return;
      blackoutOverlay.classList.add("active");
      setTimeout(() => {
        blackoutOverlay.classList.remove("active");
        randomBlackoutAttack();
      }, 180);
    }, 600 + Math.random() * 1400);
  }

  document.addEventListener("mousemove", (e) => {
    if (!glitchActive) return;

    const fragment = document.createElement("div");
    fragment.className = "cursor-fragment";
    fragment.style.left = e.clientX + "px";
    fragment.style.top = e.clientY + "px";

    document.body.appendChild(fragment);
    setTimeout(() => fragment.remove(), 500);
  });

  startBtn.addEventListener("click", () => {
    const text = lyricsInput.value.trim();
    if (!text) {
      statusText.textContent = "Please paste some text first.";
      return;
    }

    sentences = splitIntoSentences(text);
    repeatedWordsSet = computeRepeatedWords(text);

    currentIndex = 0;
    showMode = "playing";

    generator.style.display = "none";

    statusText.textContent = "Show running. Click anywhere to reveal the next sentence or word.";
    hintText.textContent = "Click anywhere on the screen to advance.";
    resetGlitchVisuals();

    stage.classList.add("cracked-soft");

    startEndlessCodeRain(); // start infinite code as soon as show begins

    showSentence(currentIndex);
  });

  document.addEventListener("click", (e) => {
    if (e.target.tagName === "BUTTON" || e.target === lyricsInput) return;

    if (showMode === "playing") {
      currentIndex++;
      if (currentIndex < sentences.length) {
        showSentence(currentIndex);
      } else {
        showMode = "finished";
        sentenceDisplay.innerHTML = "";
        sentenceDisplay.textContent = "— END OF TEXT —";
        statusText.textContent = "Show finished. Code and shards keep falling until you refresh.";
        hintText.textContent = "Use Retry to replay with same text, or Regenerate to paste new text.";
        endControls.style.display = "flex";
      }
    }
  });

  retryBtn.addEventListener("click", () => {
    if (!sentences.length) return;
    showMode = "playing";
    currentIndex = 0;
    endControls.style.display = "none";
    statusText.textContent = "Replaying show. Code rain continues.";
    hintText.textContent = "Click anywhere on the screen to advance.";
    resetGlitchVisuals();
    stage.classList.add("cracked-soft");
    showSentence(currentIndex);
  });

  regenBtn.addEventListener("click", () => {
    showMode = "idle";
    sentences = [];
    currentIndex = 0;
    repeatedWordsSet = new Set();
    sentenceDisplay.innerHTML = "";
    generator.style.display = "block";
    endControls.style.display = "none";
    resetGlitchVisuals();

    statusText.textContent =
      "Short words appear one character at a time. Repeated words cause extra code shards to fall.";
    subtitleText.textContent =
      "Paste your text once, then reveal it sentence by sentence. Infinite Python shards keep raining.";
    hintText.textContent =
      "After you start, click anywhere on the screen to show the next sentence or word.";
    // pixel shards and code rain stay; only refresh wipes them.
  });
</script>
</body>
</html>
